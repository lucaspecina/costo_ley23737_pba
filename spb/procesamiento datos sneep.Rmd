---
title: "Actualización datos ley 23737"
output: html_notebook
---

SNEEP cargo los datos de 2019. Hay que actualizar la misma info q teniamos hasta 2018.
- https://github.com/datos-justicia-argentina/Sistema-Nacional-de-Estadisticas-sobre-Ejecucion-de-la-Pena-SNEEP/blob/master/Sistema-Nacional-de-Estadisticas-sobre-Ejecucion-de-la-Pena-SNEEP-metadata.md
- http://datos.jus.gob.ar/dataset/sneep


```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(tidyr)

# sneep <- read_csv("C:/Users/Usuario/Desktop/Lucas/1- pe/7- ley 23737/data/sneep-unificado-2002-2019.csv")
# sneep <- read_csv("/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/data/sneep-unificado-2002-2019.csv")

```

Datasets generales a usar
---
- provinciales : todos delitos, todas provincias (seleccionadas)
- pba : todos delitos, PBA
- ley23737_provs : delitos 23737, todas las provincias (seleccionadas)
- ley23737_pba : delitos 23737, PBA

```{r}

#### datasets de todos los delitos ####

# esto deja solo las provinciales
provinciales <- sneep %>% 
  filter(reparticion_descripcion=='Provincial') %>%
  filter(
    (provincia_descripcion=='Buenos Aires' & anio_censo>=2005) |
                (provincia_descripcion=='Chaco' & anio_censo>=2015) |
                (provincia_descripcion=='Córdoba' & anio_censo>=2012) |
                (provincia_descripcion=='Formosa' & anio_censo>=2015) |
                (provincia_descripcion=='Salta' & anio_censo>=2014) |
                (provincia_descripcion=='Entre Rios' & anio_censo>=2018) |
                (provincia_descripcion=='Santiago del Estero' & anio_censo>=2018))


# delitos totales de la PBA
pba <- provinciales %>% filter(provincia_descripcion=='Buenos Aires')


#### datasets de solo drogas ####

# ley 23737 PBA
ley23737_pba <- pba %>% filter((
      delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
      delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)')) 


# ley 23737 para todas las provincias
ley23737_provs <- provinciales %>% filter((
      delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
      delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
      delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)')) 
          

```

Analisis basicos para la PBA
---

#### Cantidad de presos totales por año
```{r}

# cantidad de presos totales
presos_total_por_anio <- pba %>% group_by(anio_censo) %>% summarise(presos_totales= n())
# cantidad de presos por ley23737
presos_ley23737_por_anio <- ley23737_pba %>% group_by(anio_censo) %>% summarise(presos_ley23737= n())
# joineo
presos_porcen23737_por_anio <- presos_total_por_anio %>% inner_join(presos_ley23737_por_anio, by='anio_censo')
# calculo porcentaje
presos_porcen23737_por_anio <- presos_porcen23737_por_anio %>% mutate(porcen_ley23737 = (presos_ley23737/presos_totales))

print(presos_porcen23737_por_anio)

#write.csv(presos_porcen23737_por_anio, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_por_anio.csv',row.names = FALSE)
```

#### Cantidad de presos por 23737 por año
```{r}

data_plot <- presos_porcen23737_por_anio %>% pivot_longer(c(presos_totales,presos_ley23737), names_to='tipo', values_to='cantidad') 
  
ggplot(data_plot, aes(x=anio_censo,y=cantidad,color=tipo)) + geom_line() + geom_point() +
    labs(title="Provincia de Buenos Aires",x="Año de censo", y = "Cantidad de presos")

```

```{r}

```

```{r}

```

Analisis para todas las provincias
---

Desde 2016
Buenos Aires, Chaco, Cordoba, Formosa, Salta, Entre Rios (18/19), Santiago del Estero (18/19), CABA (19)

#### Cantidad de presos totales y por droga, por año y provincia
```{r}

# cantidad de presos totales por año y provincia
presos_total_por_anio_prov <- provinciales %>% group_by(anio_censo,provincia_descripcion) %>% 
  summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_provs %>% group_by(anio_censo,provincia_descripcion) %>%
  summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% 
  inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo','provincia_descripcion'))

# calculo porcentaje
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))

# calculo cambios porcentuales por año
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% group_by(provincia_descripcion) %>%
  mutate(cambioporc_totales = (presos_totales-lag(presos_totales))/lag(presos_totales) ,
         cambioporc_23737 = (presos_ley23737-lag(presos_ley23737))/lag(presos_ley23737))

# write.csv(presos_porcen23737_por_anio_prov, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_por_anio_prov.csv',row.names = FALSE)

print(presos_porcen23737_por_anio_prov)

```

#### Graficar
```{r}

ggplot(presos_porcen23737_por_anio_prov, aes(x=anio_censo,y=porcen_ley23737,color=provincia_descripcion)) + geom_line() + geom_point() +
    labs(title="Porcentaje (%) de presos/as por ley 23737 por provincias elegidas",x="Año de censo", y = "Porcentaje de presos por 23737 (%)")

```

Por provincia y por genero
---

Le agrego cuatro columnas : mujeres_total, mujeres_droga, varones_total, varones_droga


#### Presos totales y droga, por año, provincia y genero

Los de genero no tienen NAs asi que PRUEBO que sumas de categorias sea igual a presos_totales/ley23737
```{r}
## PRUEBAS NA
# bien, no tiene NAs


# cantidad de presos totales
presos_total_por_anio_prov <- provinciales %>% 
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_provs %>% 
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% 
  inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo','provincia_descripcion'))


# POR GENERO
# total mujeres
mujeres_total <- provinciales %>% filter(genero_descripcion=='Femenino') %>% 
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(mujeres_total= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  left_join(mujeres_total,by=c('anio_censo','provincia_descripcion'))

# droga mujeres
mujeres_droga <- ley23737_provs %>% filter(genero_descripcion=='Femenino') %>%
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(mujeres_droga= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>%
  left_join(mujeres_droga,by=c('anio_censo','provincia_descripcion'))

# total varones
varones_total <- provinciales %>% filter(genero_descripcion=='Masculino') %>% 
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(varones_total= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>%
  left_join(varones_total,by=c('anio_censo','provincia_descripcion'))

# droga varones
varones_droga <- ley23737_provs %>% filter(genero_descripcion=='Masculino') %>%
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(varones_droga= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>%
  left_join(varones_droga,by=c('anio_censo','provincia_descripcion'))

# total transexuales
transexual_total <- provinciales %>% filter(genero_descripcion=='Transexual') %>%
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(transexual_total= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>%
  left_join(transexual_total,by=c('anio_censo','provincia_descripcion'))

# droga transexuales
transexual_droga <- ley23737_provs %>% filter(genero_descripcion=='Transexual') %>%
  group_by(anio_censo,provincia_descripcion) %>% 
  summarise(transexual_droga= n())
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>%
  left_join(transexual_droga,by=c('anio_censo','provincia_descripcion'))


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


## PRUEBAS SUMAS
# bien, da igual


# calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))

# de total de GENERO, cuantas son por droga
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% mutate(
      mujeres_porcen_droga = mujeres_droga/mujeres_total,
      varones_porcen_droga = varones_droga/varones_total,
      transexuales_porcen_droga = transexual_droga/transexual_total)
# del total de delitos, que porcentaje por genero
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% mutate(
      total_porcen_mujeres = mujeres_total/(mujeres_total+varones_total+transexual_total),
      total_porcen_varones = varones_total/(mujeres_total+varones_total+transexual_total),
      total_porcen_transexuales = transexual_total/(mujeres_total+varones_total+transexual_total))
# de delitos droga, que porcentaje por genero
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% mutate(
      droga_porcen_mujeres = mujeres_droga/(mujeres_droga+varones_droga+transexual_droga),
      droga_porcen_varones = varones_droga/(mujeres_droga+varones_droga+transexual_droga),
      droga_porcen_transexuales = transexual_droga/(mujeres_droga+varones_droga+transexual_droga))

# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)

# write.csv(presos_porcen23737_por_anio_prov, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anio_provs_genero.csv',row.names = FALSE)
presos_porcen23737_por_anio_prov
```


```{r}

```

```{r}

```


Procesados y condenados por droga y no droga
---

Primero saco los otros que no sean condenados y procesados y a eso le aplico lo de provinciales
```{r}

provinciales_proce_conde <- sneep %>% filter((situacion_legal_descripcion=='Procesado') | (situacion_legal_descripcion=='Condenado')) %>%
  filter(anio_censo>=2005 & reparticion_descripcion=='Provincial')

# BA_proce_conde <- sneep %>% filter((situacion_legal_descripcion=='Procesado') | (situacion_legal_descripcion=='Condenado')) %>%
#   filter(anio_censo>=2006 & reparticion_descripcion=='Provincial' & provincia_descripcion=='Buenos Aires') %>%
#   select(c(es_reincidente_id,es_reincidente_descripcion))

```

Dejo solo los que no son de drogas
```{r}
# delitos por NO ley 23737
NOdroga_provs <- provinciales_proce_conde %>%
  filter(
    ((delito1_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito1_descripcion))) & 
    ((delito2_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito2_descripcion))) &
    ((delito3_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito3_descripcion))) & 
    ((delito4_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito4_descripcion))) &
    ((delito5_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito5_descripcion)))) %>%
  filter(
    (provincia_descripcion=='Buenos Aires') |
      (provincia_descripcion=='Chaco' & anio_censo>=2015) |
      (provincia_descripcion=='Córdoba' & anio_censo>=2012) |
      (provincia_descripcion=='Formosa' & anio_censo>=2015) |
      (provincia_descripcion=='Salta' & anio_censo>=2014) |
      (provincia_descripcion=='Entre Rios' & anio_censo>=2018) |
      (provincia_descripcion=='Santiago del Estero' & anio_censo>=2018)
  )


```

Saco los numeros y porcentajes de procesados para los no droga

```{r}

procesados_NOdroga <- NOdroga_provs %>% filter(situacion_legal_descripcion=='Procesado') %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(procesados_NOdroga= n())

condenados_NOdroga <- NOdroga_provs %>% filter(situacion_legal_descripcion=='Condenado') %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(condenados_NOdroga= n())

# join
procesados_porcen_NOdroga <- procesados_NOdroga %>% inner_join(condenados_NOdroga, by=c('anio_censo','provincia_descripcion'))
# calculo porcentajes
procesados_porcen_NOdroga <- procesados_porcen_NOdroga %>% mutate(procesados_porcen_NOdroga = procesados_NOdroga/(procesados_NOdroga+condenados_NOdroga))
```

Dejo solo los que son de drogas
```{r}
# delitos por ley 23737
droga_provs <- provinciales_proce_conde %>%
    filter((delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
            delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)')) %>%
  filter(
    (provincia_descripcion=='Buenos Aires') |
      (provincia_descripcion=='Chaco' & anio_censo>=2015) |
      (provincia_descripcion=='Córdoba' & anio_censo>=2012) |
      (provincia_descripcion=='Formosa' & anio_censo>=2015) |
      (provincia_descripcion=='Salta' & anio_censo>=2014) |
      (provincia_descripcion=='Entre Rios' & anio_censo>=2018) |
      (provincia_descripcion=='Santiago del Estero' & anio_censo>=2018)
  )


```


Saco los numeros y porcentajes de procesados para los de droga

```{r}

procesados_droga <- droga_provs %>% filter(situacion_legal_descripcion=='Procesado') %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(procesados_droga= n())

condenados_droga <- droga_provs %>% filter(situacion_legal_descripcion=='Condenado') %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(condenados_droga= n())

# join
procesados_porcen_droga <- procesados_droga %>% inner_join(condenados_droga, by=c('anio_censo','provincia_descripcion'))
# calculo porcentajes
procesados_porcen_droga <- procesados_porcen_droga %>% mutate(procesados_porcen_droga = procesados_droga/(procesados_droga+condenados_droga))
```

Joineo los resultados de drogas y no drogas

```{r}

procesados_porcen_todos <- procesados_porcen_droga %>% inner_join(procesados_porcen_NOdroga, by=c('anio_censo','provincia_descripcion'))

# hago la resta
procesados_porcen_todos <- procesados_porcen_todos %>% mutate(diferencia_procesados = procesados_porcen_droga - procesados_porcen_NOdroga)

procesados_porcen_todos

# write.csv(procesados_porcen_todos, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/procesados_porcen_todos.csv',row.names = FALSE)
```

```{r}
# graficos de lineas (con la diferencia entre porcentajes de procesados por droga y no droga)
ggplot(procesados_porcen_todos, aes(x=anio_censo,y=diferencia_procesados,color=provincia_descripcion)) + geom_line() + geom_point() +
    labs(title="Diferencia de porcentajes de procesados entre drogas y no drogas",x="Año de censo", y = "Diferencia de porcentajes entre drogas y no drogas")

# para solo buenos aires (es un gather) saco el 2005 porq solo fue diciembre lo de drogas
data_plotear <- procesados_porcen_todos %>% filter(provincia_descripcion=='Buenos Aires' & anio_censo>= 2006) %>% gather(tipo_delito, porcentaje, c(procesados_porcen_droga,procesados_porcen_NOdroga),factor_key=TRUE)

ggplot(data_plotear, aes(x=anio_censo,y=porcentaje,color=tipo_delito)) + geom_line() + geom_point() +
    labs(title="Porcentajes de procesados entre drogas y no drogas (PBA)",x="Año de censo", y = "Porcentajes de procesados(%)")

```

```{r}
# prueba simple : evolucion de porcentaje de procesados generales
prueba_BA_proce <- provinciales %>% filter(provincia_descripcion=='Buenos Aires')


prueba_BA_proce_pro <- prueba_BA_proce %>% filter(situacion_legal_descripcion=='Procesado') %>%
  group_by(anio_censo) %>% summarise(procesados= n())

prueba_BA_proce_con <- prueba_BA_proce %>% filter(situacion_legal_descripcion=='Condenado') %>%
  group_by(anio_censo) %>% summarise(condenados= n())

# join
prueba_BA_proce <- prueba_BA_proce_pro %>% inner_join(prueba_BA_proce_con, by=c('anio_censo'))
# calculo porcentajes
prueba_BA_proce <- prueba_BA_proce %>% mutate(procesados_porcen = procesados/(procesados+condenados))

# write.csv(prueba_BA_proce, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/prueba_BA_proce.csv',row.names = FALSE)

ggplot(prueba_BA_proce, aes(x=anio_censo,y=procesados_porcen)) + geom_line() + geom_point() +
    labs(title="Diferencia de porcentajes de procesados PBA",x="Año de censo", y = "Porcentajes procesados")
```


Porcentaje por ley 23737 por cada unidad
---

todos delitos
```{r}

# todos delitos
total_provs <- provinciales


# hago el agrupamiento tambien por unidad
total_unidades <- total_provs %>% group_by(anio_censo,provincia_descripcion, establecimiento_descripcion) %>%
      summarise(cantidad_total = n())

```

Droga dataset y agrupado
```{r}
# delitos por ley 23737
droga_provs <- ley23737_provs


droga_unidades <- droga_provs %>% group_by(anio_censo,provincia_descripcion, establecimiento_descripcion) %>%
      summarise(cantidad_droga = n())

```


Join y calculos
```{r}

unidades <- total_unidades %>% inner_join(droga_unidades, by=c('anio_censo','provincia_descripcion','establecimiento_descripcion'))

unidades <- unidades %>% mutate(prop_droga = cantidad_droga / cantidad_total )

unidades_pba_2019 <- unidades %>% filter(provincia_descripcion == 'Buenos Aires' & anio_censo==2019) %>% arrange(desc(cantidad_total))

#write.csv(unidades_pba_2019, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/unidades_pba_2019.csv')

# tomando las 20 unidades con mas presos, el porcentaje promedio de presos x droga es
mean(unidades_pba_2019 %>% head(20) %>% pull(prop_droga)) # 12.35 %

unidades_pba_2019
```

```{r}
ggplot(unidades_pba_2019 , aes(x=prop_droga)) + geom_histogram(aes(y=..density..), colour="black", fill="white") + geom_density(alpha=.2, fill="#FF6666") + geom_vline(aes(xintercept=mean(unidades_pba_2019$prop_droga)), color="blue", linetype="dashed", size=1) + 
  scale_x_continuous(breaks = seq(0, 60, by = 5)) +
    labs(title="Distribución de los porcentajes de presos/as por droga por unidad",x="Porcentaje de presos/as por droga (%)", y = "Densidad (frecuencia relativa)")

ggplot(unidades_pba_2019 , aes(x=prop_droga)) + geom_histogram( colour="black", fill="white") + geom_vline(aes(xintercept=mean(unidades_pba_2019$prop_droga)), color="blue", linetype="dashed", size=1) + 
  scale_x_continuous(breaks = seq(0, 60, by = 5)) 
```


```{r}

```

```{r}

```

Reincidencias
---

Comparo la proporcion de reincidentes por delitos de droga y no droga.
Hay que usar solo los datos de condenados porque no cargan las reincidencias para los procesados.


```{r}
# saco los NA en es_reincidente_id
BA_reinci <- sneep %>% filter(!is.na(es_reincidente_id)) %>%
  filter(anio_censo>=2006 & reparticion_descripcion=='Provincial' & provincia_descripcion=='Buenos Aires') %>%
  filter(situacion_legal_descripcion=='Condenado') %>% filter(es_reincidente_id!=0)

```

Dejo solo los que no son de drogas
```{r}
# delitos por NO ley 23737
NOdroga_reinci <- BA_reinci %>%
  filter(
    ((delito1_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito1_descripcion))) & 
    ((delito2_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito2_descripcion))) &
    ((delito3_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito3_descripcion))) & 
    ((delito4_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito4_descripcion))) &
    ((delito5_descripcion!='Infracción ley n° 23.737 (estupefacientes)') | (is.na(delito5_descripcion)))) 
```

Saco los numeros y porcentajes de procesados para los no droga

```{r}

reinci_NOdroga <- NOdroga_reinci %>% filter(es_reincidente_id %in% c(2,3,4)) %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(reincidentes_NOdroga= n())

NOreinci_NOdroga <- NOdroga_reinci %>% filter(es_reincidente_id %in% c(1)) %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(NOreincidentes_NOdroga= n())

# join
reincidentes_porcen_NOdroga <- reinci_NOdroga %>% inner_join(NOreinci_NOdroga, by=c('anio_censo'))
# calculo porcentajes
reincidentes_porcen_NOdroga <- reincidentes_porcen_NOdroga %>% mutate(reinci_porcen_NOdroga = reincidentes_NOdroga/(reincidentes_NOdroga+NOreincidentes_NOdroga))

```

Dejo solo los que son de drogas
```{r}
# delitos por ley 23737
droga_reinci <- BA_reinci %>%
    filter((delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
            delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
            delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)')) 


```


Saco los numeros y porcentajes de procesados para los de droga

```{r}

reinci_droga <- droga_reinci %>% filter(es_reincidente_id %in% c(2,3,4)) %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(reincidentes_droga= n())

NOreinci_droga <- droga_reinci %>% filter(es_reincidente_id %in% c(1)) %>%
  group_by(anio_censo,provincia_descripcion) %>% summarise(NOreincidentes_droga= n())

# join
reincidentes_porcen_droga <- reinci_droga %>% inner_join(NOreinci_droga, by=c('anio_censo'))
# calculo porcentajes
reincidentes_porcen_droga <- reincidentes_porcen_droga %>% mutate(reinci_porcen_droga = reincidentes_droga/(reincidentes_droga+NOreincidentes_droga))

```

Joineo los resultados de drogas y no drogas

```{r}

reinci_porcen_todos <- reincidentes_porcen_droga %>% inner_join(reincidentes_porcen_NOdroga, by=c('anio_censo'))
reinci_porcen_todos
# write.csv(reinci_porcen_todos, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/reinci_porcen_todos.csv')
```

```{r}

# gather
data_plotear_reinci <- reinci_porcen_todos %>% gather(tipo_delito, porcentaje_reinci, c(reinci_porcen_droga,reinci_porcen_NOdroga),factor_key=TRUE) %>% select(c(anio_censo, tipo_delito, porcentaje_reinci))

ggplot(data_plotear_reinci, aes(x=anio_censo,y=porcentaje_reinci,color=tipo_delito)) + geom_line() + geom_point() +
    labs(title="Porcentajes de reincidentes entre drogas y no drogas (PBA)",x="Año de censo", y = "Porcentajes de reincidentes (%)")

```

Ver todos los valores de la variable es_reincidente_descripcion por separado y su evolucion
```{r}

reinci_separado_droga <- droga_reinci %>% group_by(anio_censo,es_reincidente_descripcion) %>% summarise(cantidad=n()) %>%
  mutate(es_reincidente_descripcion = ifelse(grepl('Reincidente',es_reincidente_descripcion),'Reincidente',es_reincidente_descripcion)) %>%
  filter(es_reincidente_descripcion != 'Primario')

# write.csv(reinci_separado_droga, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/reinci_separado_droga.csv')

ggplot(reinci_separado_droga, aes(x=anio_censo,y=cantidad,color=es_reincidente_descripcion)) + geom_line() + geom_point() + labs(title="Cantidad de presos/as por droga segun reincidencia (PBA)",x="Año de censo", y = "Cantidad de presos/as")

```



# CABA

```{r}

caba <- sneep %>% filter(jurisdiccion_descripcion == 'Justicia de la Ciudad de Buenos Aires')

caba_droga <- caba %>% filter((
delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)'))



```



#Otras estadisticas


Nacionalidad
---

```{r}

# ley 23737
ley23737_provs <- provinciales %>%
  
  filter((delito1_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | delito2_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | 
         delito3_descripcion=='Infracción ley n° 23.737 (estupefacientes)' | delito4_descripcion=='Infracción ley n° 23.737 (estupefacientes)' |
         delito5_descripcion=='Infracción ley n° 23.737 (estupefacientes)')) 
  
```


#### Hacer de todas las provs en 2019 (esta ok)
```{r}

# cantidad de presos totales
presos_total_por_anio_prov <- provinciales %>% 
  filter(anio_censo==2019) %>%
  group_by(provincia_descripcion) %>% summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_provs %>% 
  filter(anio_censo==2019) %>%
  group_by(provincia_descripcion) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% inner_join(presos_ley23737_por_anio_prov, by=c('provincia_descripcion'))


# PRIMERO VER LAS NACIONALIDADES MAS COMUNES (5)
table(provinciales %>% filter(provincia_descripcion=='Buenos Aires' & anio_censo==2019) %>% pull(nacionalidad_descripcion))


# POR NACIONALIDAD
for(nacion in c('Argentina','Paraguaya','Peruana','Boliviana','Uruguaya','Chilena','Brasileña','Colombiana','Otras')){
  
  # total
  nacionalidad_total <- provinciales %>% filter(anio_censo==2019 & nacionalidad_descripcion==nacion) %>%
    group_by(provincia_descripcion) %>% summarise("{nacion}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('provincia_descripcion'))
  
  # drogas
  nacionalidad_droga <- ley23737_provs %>% filter(anio_censo==2019 & nacionalidad_descripcion==nacion) %>% 
    group_by(provincia_descripcion) %>% summarise("{nacion}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('provincia_descripcion'))
  
}

# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)

#### PRUEBA SUMAS
# bien, hago con el total porq quiero ver eso


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_Argentina = Argentina_total/(presos_totales),
            total_porcen_Paraguaya = Paraguaya_total/(presos_totales),
            total_porcen_Boliviana = Boliviana_total/(presos_totales),
            total_porcen_Peruana = Peruana_total/(presos_totales),
            total_porcen_Uruguaya = Uruguaya_total/(presos_totales),
            total_porcen_Chilena = Chilena_total/(presos_totales),
            total_porcen_Brasileña = Brasileña_total/(presos_totales),
            total_porcen_Colombiana = Colombiana_total/(presos_totales),
            total_porcen_Otras = Otras_total/(presos_totales))
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_Argentina = 
Argentina_droga/(presos_ley23737),
            droga_porcen_Paraguaya = 
Paraguaya_droga/(presos_ley23737),
            droga_porcen_Boliviana = Boliviana_droga/(presos_ley23737),
            droga_porcen_Peruana = Peruana_droga/(presos_ley23737),
            droga_porcen_Uruguaya = Uruguaya_droga/(presos_ley23737),
            droga_porcen_Chilena = Chilena_droga/(presos_ley23737),
            droga_porcen_Brasileña = Brasileña_droga/(presos_ley23737),
            droga_porcen_Colombiana = Colombiana_droga/(presos_ley23737),
            droga_porcen_Otras = Otras_droga/(presos_ley23737)
  )

presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]
presos_porcen23737_por_anio_prov.T

write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_2019_provs_nacionalidades.csv',row.names = FALSE)
```


#### Nacionalidades de PBA por año (esta ok)

```{r}
### PRUEBA NAs
table(pba %>% pull(nacionalidad_descripcion))
# bien, no tiene NAs


# cantidad de presos totales
presos_total_por_anio_prov <- pba %>% 
  group_by(anio_censo) %>% summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_pba %>% 
  group_by(anio_censo) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% 
  inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo'))


# POR NACIONALIDAD
for(nacion in c('Argentina','Paraguaya','Peruana','Boliviana','Uruguaya','Chilena','Brasileña','Colombiana','Otras')){
  
  # total
  nacionalidad_total <- pba %>% filter(nacionalidad_descripcion==nacion) %>%
    group_by(anio_censo) %>% summarise("{nacion}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('anio_censo'))
  
  # drogas
  nacionalidad_droga <- ley23737_pba %>% filter(nacionalidad_descripcion==nacion) %>% 
    group_by(anio_censo) %>% summarise("{nacion}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('anio_censo'))
  
}


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


### PRUEBA SUMAS
# bien, parecido asi que sumo el total (porque quiero ver sobre el total posta)


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_Argentina = 
Argentina_total/(presos_totales),
            total_porcen_Paraguaya = 
Paraguaya_total/(presos_totales),
            total_porcen_Boliviana = Boliviana_total/(presos_totales),
            total_porcen_Peruana = Peruana_total/(presos_totales),
            total_porcen_Uruguaya = Uruguaya_total/(presos_totales),
            total_porcen_Chilena = Chilena_total/(presos_totales),
            total_porcen_Brasileña = Brasileña_total/(presos_totales),
            total_porcen_Colombiana = Colombiana_total/(presos_totales),
            total_porcen_Otras = Otras_total/(presos_totales)
  )
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_Argentina = 
Argentina_droga/(presos_ley23737),
            droga_porcen_Paraguaya = 
Paraguaya_droga/(presos_ley23737),
            droga_porcen_Boliviana = Boliviana_droga/(presos_ley23737),
            droga_porcen_Peruana = Peruana_droga/(presos_ley23737),
            droga_porcen_Uruguaya = Uruguaya_droga/(presos_ley23737),
            droga_porcen_Chilena = Chilena_droga/(presos_ley23737),
            droga_porcen_Brasileña = Brasileña_droga/(presos_ley23737),
            droga_porcen_Colombiana = Colombiana_droga/(presos_ley23737),
            droga_porcen_Otras = Otras_droga/(presos_ley23737)
  )

# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]

# write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anios_PBA_nacionalidades.csv',row.names = FALSE)
presos_porcen23737_por_anio_prov.T

```


Nivel de instruccion
---

Solo de PBA

Hay NAs. Asumo que estna igualmente distribuidos, por lo tanto hacemos la proporcion sobre la SUMA
```{r}
### PRUEBA NAs
sum(is.na(pba %>% filter(anio_censo==2019) %>% pull(nivel_instruccion_descripcion)))
# si hay NAs


# cantidad de presos totales
presos_total_por_anio_prov <- pba %>%
  group_by(anio_censo) %>% summarise(presos_totales= n())

# cantidad de presos droga pba
presos_ley23737_por_anio_prov <- ley23737_pba %>%
  group_by(anio_censo) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo'))


# ver los niveles de instruccion
niveles_instruccion <- c("Primario incompleto" , "Primario completo" , "Secundario incompleto" , "Ninguno", "Universitario completo" , "Secundario completo" , "Terciario completo" ,"Terciario incompleto",
 "Polimodal Incompleto" , "EGB 3 Completo" , "EGB 2 Completo" , "EGB 1 Incompleto",
 "Universitario incompleto" , "EGB 1 Completo" , "EGB 3 Incompleto","Polimodal Completo","EGB 2 Incompleto")

# POR NIVEL DE INSTRUCCION
for(instruccion in niveles_instruccion){
  
  # total
  nacionalidad_total <- pba %>% filter(nivel_instruccion_descripcion==instruccion) %>%
    group_by(anio_censo) %>% summarise("{instruccion}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('anio_censo'))
  
  # drogas
  nacionalidad_droga <- ley23737_pba %>% filter(nivel_instruccion_descripcion==instruccion) %>% 
    group_by(anio_censo) %>% summarise("{instruccion}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('anio_censo'))
  
}


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


### PRUEBA SUMAS
# hacemos sobre la suma individual de todos


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_Primario_incompleto = `Primario incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Primario_completo = `Primario incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Secundario_incompleto = `Secundario incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Secundario_completo = `Secundario completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Ninguno = Ninguno_total/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Universitario_completo = `Universitario completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Universitario_incompleto = `Universitario incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Terciario_completo = `Terciario completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Terciario_incompleto = `Terciario incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Polimodal_Incompleto = `Polimodal Incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_Polimodal_Completo = `Polimodal Completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_3_Completo = `EGB 3 Completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_3_Incompleto = `EGB 3 Incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_2_Completo = `EGB 2 Completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_2_Incompleto = `EGB 2 Incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_1_Completo = `EGB 1 Completo_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`),
            total_porcen_EGB_1_Incompleto = `EGB 1 Incompleto_total`/(`Primario incompleto_total`+ `Primario incompleto_total` + `Secundario incompleto_total` + `Secundario completo_total` + Ninguno_total + `Universitario completo_total` + `Universitario incompleto_total` + `Terciario completo_total` + `Terciario incompleto_total` + `Polimodal Incompleto_total` +`Polimodal Completo_total` +  `EGB 3 Completo_total` + `EGB 3 Incompleto_total` + `EGB 2 Completo_total` + `EGB 2 Incompleto_total` + `EGB 1 Completo_total` + `EGB 1 Incompleto_total`)  )
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_Primario_incompleto = `Primario incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Primario_completo = `Primario incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Secundario_incompleto = `Secundario incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Secundario_completo = `Secundario completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Ninguno = Ninguno_droga/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Universitario_completo = `Universitario completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Universitario_incompleto = `Universitario incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Terciario_completo = `Terciario completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Terciario_incompleto = `Terciario incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Polimodal_Incompleto = `Polimodal Incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_Polimodal_Completo = `Polimodal Completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_3_Completo = `EGB 3 Completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_3_Incompleto = `EGB 3 Incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_2_Completo = `EGB 2 Completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_2_Incompleto = `EGB 2 Incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_1_Completo = `EGB 1 Completo_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`),
            droga_porcen_EGB_1_Incompleto = `EGB 1 Incompleto_droga`/(`Primario incompleto_droga`+ `Primario incompleto_droga` + `Secundario incompleto_droga` + `Secundario completo_droga` + Ninguno_droga + `Universitario completo_droga` + `Universitario incompleto_droga` + `Terciario completo_droga` + `Terciario incompleto_droga` + `Polimodal Incompleto_droga` +`Polimodal Completo_droga` +  `EGB 3 Completo_droga` + `EGB 3 Incompleto_droga` + `EGB 2 Completo_droga` + `EGB 2 Incompleto_droga` + `EGB 1 Completo_droga` + `EGB 1 Incompleto_droga`)  )

presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]
presos_porcen23737_por_anio_prov.T

# write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anios_PBA_niveles_instruccion.csv',row.names = FALSE)





```



Ultima situacion laboral
---

Solo para PBA

```{r}
#### PRUEBA NAs
sum(is.na(pba %>% filter(anio_censo==2019) %>% pull(ultima_situacion_laboral_descripcion)))
# hay 39 NAs, muy poco

# cantidad de presos totales
presos_total_por_anio_prov <- pba %>%
  group_by(anio_censo) %>% summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_pba %>% 
  group_by(anio_censo) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo'))


# ver las ultimas situaciones laborales
situaciones_laborales <- c("Desocupado" , "Trabajador de tiempo completo" , "Trabajador de tiempo parcial")

# POR NIVEL DE INSTRUCCION
for(laburo in situaciones_laborales){
  
  # total
  nacionalidad_total <- pba %>% filter(ultima_situacion_laboral_descripcion==laburo) %>%
    group_by(anio_censo) %>% summarise("{laburo}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('anio_censo'))
  
  # drogas
  nacionalidad_droga <- ley23737_pba %>% filter(ultima_situacion_laboral_descripcion==laburo) %>% 
    group_by(anio_censo) %>% summarise("{laburo}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('anio_censo'))
  
}


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


### PRUEBA SUMAS
# no da lo mismo para los primeros años, para los ultimos casi lo mismo. Uso las sumas


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por ultima_situacion_laboral_descripcion
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_Desocupado = Desocupado_total/(Desocupado_total + `Trabajador de tiempo completo_total` + `Trabajador de tiempo parcial_total`),
            total_porcen_Trabajador_de_tiempo_completo = `Trabajador de tiempo completo_total`/(Desocupado_total + `Trabajador de tiempo completo_total` + `Trabajador de tiempo parcial_total`),
            total_porcen_Trabajador_de_tiempo_parcial = `Trabajador de tiempo parcial_total`/(Desocupado_total + `Trabajador de tiempo completo_total` + `Trabajador de tiempo parcial_total`) )
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_Desocupado = Desocupado_droga/(Desocupado_droga + `Trabajador de tiempo completo_droga` + `Trabajador de tiempo parcial_droga`),
            droga_porcen_Trabajador_de_tiempo_completo = `Trabajador de tiempo completo_droga`/(Desocupado_droga + `Trabajador de tiempo completo_droga` + `Trabajador de tiempo parcial_droga`),
            droga_porcen_Trabajador_de_tiempo_parcial = `Trabajador de tiempo parcial_droga`/(Desocupado_droga + `Trabajador de tiempo completo_droga` + `Trabajador de tiempo parcial_droga`) )


presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]
presos_porcen23737_por_anio_prov.T

# write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anios_PBA_ultima_situacion_laboral.csv',row.names = FALSE)




```


Capacitacion laboral al ingresar
---

Solo para PBA

```{r}
### PRUEBAS NAs
sum(is.na(pba %>% filter(anio_censo==2006) %>% pull(capacitacion_laboral_al_ingresar_descripcion)))
# hay 47 nas en 2019 pero muchos al principio

# cantidad de presos totales
presos_total_por_anio_prov <- pba %>%
  group_by(anio_censo) %>% summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_pba %>% 
  group_by(anio_censo) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo'))


# ver las ultimas situaciones laborales
capacitaciones_laborales <- c('No tiene ni oficio ni profesión', 'Tiene algún oficio', 'Tiene alguna profesión')

# POR NIVEL DE INSTRUCCION
for(capacitacion in capacitaciones_laborales){
  
  # total
  nacionalidad_total <- pba %>% filter(capacitacion_laboral_al_ingresar_descripcion==capacitacion) %>%
    group_by(anio_censo) %>% summarise("{capacitacion}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('anio_censo'))
  
  # drogas
  nacionalidad_droga <- ley23737_pba %>% filter(capacitacion_laboral_al_ingresar_descripcion==capacitacion) %>% 
    group_by(anio_censo) %>% summarise("{capacitacion}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('anio_censo'))
  
}


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)

### PRUEBAS SUMAS
# uso las sumas


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por capacitacion_laboral_al_ingresar_descripcion
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_No_tiene_ni_oficio_ni_profesión = `No tiene ni oficio ni profesión_total`/(`No tiene ni oficio ni profesión_total` + `Tiene algún oficio_total` + `Tiene alguna profesión_total`),
            total_porcen_Tiene_algún_oficio = `Tiene algún oficio_total`/(`No tiene ni oficio ni profesión_total` + `Tiene algún oficio_total` + `Tiene alguna profesión_total`),
            total_porcen_Tiene_alguna_profesión = `Tiene alguna profesión_total`/(`No tiene ni oficio ni profesión_total` + `Tiene algún oficio_total` + `Tiene alguna profesión_total`) )
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_No_tiene_ni_oficio_ni_profesión = `No tiene ni oficio ni profesión_droga`/(`No tiene ni oficio ni profesión_droga` + `Tiene algún oficio_droga` + `Tiene alguna profesión_droga`),
            droga_porcen_Tiene_algún_oficio = `Tiene algún oficio_droga`/(`No tiene ni oficio ni profesión_droga` + `Tiene algún oficio_droga` + `Tiene alguna profesión_droga`),
            droga_porcen_Tiene_alguna_profesión = `Tiene alguna profesión_droga`/(`No tiene ni oficio ni profesión_droga` + `Tiene algún oficio_droga` + `Tiene alguna profesión_droga`) )


presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]
presos_porcen23737_por_anio_prov.T

# write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anios_PBA_capacitacion_laboral.csv',row.names = FALSE)


```


Mujer con hijos mujer_tiene_hijos_intramuro
---

Solo PBA 

```{r}
### PRUEBAS NAs
sum(is.na(pba %>% filter(genero_descripcion=='Femenino' & anio_censo==2019) %>% pull(mujer_tiene_hijos_intramuro)))
sum(is.na(pba %>% filter(genero_descripcion=='Femenino' & anio_censo==2006) %>% pull(mujer_tiene_hijos_intramuro)))
# no hay NAs

# cantidad de presos totales
presos_total_por_anio_prov <- pba %>% filter(genero_descripcion=='Femenino') %>%
  group_by(anio_censo) %>% summarise(presos_totales= n())

# cantidad de presos droga por año y provincia
presos_ley23737_por_anio_prov <- ley23737_pba %>% filter(genero_descripcion=='Femenino') %>%
  group_by(anio_censo) %>% summarise(presos_ley23737= n())

# joineo
presos_porcen23737_por_anio_prov <- presos_total_por_anio_prov %>% inner_join(presos_ley23737_por_anio_prov, by=c('anio_censo'))


# ver las ultimas situaciones laborales
mujer_con_hijos <- c('0','1')

# POR SI TIENE HIJO O NO
for(hijo in mujer_con_hijos){
  
  # total
  nacionalidad_total <- pba %>% filter(mujer_tiene_hijos_intramuro==hijo & genero_descripcion=='Femenino') %>%
    group_by(anio_censo) %>% summarise("{hijo}_total":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_total,by=c('anio_censo'))
  
  # drogas
  nacionalidad_droga <- ley23737_pba %>% filter(mujer_tiene_hijos_intramuro==hijo & genero_descripcion=='Femenino') %>% 
    group_by(anio_censo) %>% summarise("{hijo}_droga":= n())
  presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
    left_join(nacionalidad_droga,by=c('anio_censo'))
}


# reemplazo los NA con 0
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% replace(is.na(.), 0)


### PRUEBA SUMAS
# da lo mismo asi q uso presos_total y droga


####### calculo porcentajes (sin *100)
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(porcen_ley23737 = (presos_ley23737/presos_totales))


# del total de delitos, que porcentaje por mujer_tiene_hijos_intramuro
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            total_porcen_No_tiene_hijos = `0_total`/(presos_totales),
            total_porcen_Tiene_hijos = `1_total`/(presos_totales) )
      

# de delitos droga, que porcentaje por nacionalidad
presos_porcen23737_por_anio_prov <- presos_porcen23737_por_anio_prov %>% 
  mutate(
            droga_porcen_No_tiene_hijos = `0_droga`/(presos_ley23737),
            droga_porcen_Tiene_hijos = `1_droga`/(presos_ley23737) )


presos_porcen23737_por_anio_prov.T <- as_tibble(t(presos_porcen23737_por_anio_prov), rownames = "row_names")
colnames(presos_porcen23737_por_anio_prov.T) <- head(presos_porcen23737_por_anio_prov.T,1)
presos_porcen23737_por_anio_prov.T <- presos_porcen23737_por_anio_prov.T[-1,]
presos_porcen23737_por_anio_prov.T

# write.csv(presos_porcen23737_por_anio_prov.T, '/Users/lucaspecina/Desktop/Data/Planificacion Estrategica/costo_ley23737_pba/costo_ley23737_pba/spb/presos_porcen23737_anios_PBA_mujer_hijos_intramuro.csv',row.names = FALSE)


```

```{r}

```

```{r}

```

```{r}

```

```{r}

```
